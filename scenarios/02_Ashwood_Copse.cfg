#textdomain wesnoth-lowr
[scenario]
    name= _ "Ashwood Copse"
    id=02_Ashwood_Copse
    map_file=02_Ashwood_Copse.map
    next_scenario=03_Witchmire
    turns=unlimited
    victory_when_enemies_defeated=no

    {INTRO_AND_SCENARIO_MUSIC sad.ogg northern_mountains.ogg}
    {EXTRA_SCENARIO_MUSIC knolls.ogg}
    {EXTRA_SCENARIO_MUSIC traveling_minstrels.ogg}
    {EXTRA_SCENARIO_MUSIC legends_of_the_north.ogg}
    {EXTRA_SCENARIO_MUSIC knalgan_theme.ogg}

    {DEFAULT_SCHEDULE_AFTERNOON}

    # story
    {STORY_ASHWOOD_COPSE}

    # side: Kalenz (player)
    # wmllint: validate-off
    [side]
        side=1
        {ELF_SETUP:PLAYER}
        {CHARACTER_STATS:KALENZ}
        {GOLD 100 80 60}
        income=-2
        village_gold=0
        fog=yes
        x,y=2,10
        [unit]
            {CHARACTER_STATS:LANDAR}
            x,y=3,10
        [/unit]
    [/side]
    # wmllint: validate-on

    # side: orcs (embershard)
    [side]
        side=2
        {EMBERSHARD_SETUP}
        hidden=yes
        no_leader=yes
    [/side]

    # prestart event
    [event]
        name=prestart

        # state objectives
        [objectives]
            side=1

            [objective]
                description= _ "Explore the village"
                condition=win
                [show_if]
                    {VARIABLE_CONDITIONAL LoW_S2_phase equals 1}
                [/show_if]
            [/objective]

            [objective]
                description= _ "Fight off the Embershard ambush"
                [show_if]
                    {VARIABLE_CONDITIONAL LoW_S2_phase equals 2}
                [/show_if]
            [/objective]

            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]

            # give a note about adjusted recall costs
            {RECALL_COSTS_NOTE}
        [/objectives]

        # adjust recall costs
        {ADJUST_RECALL_COST 33 50 66}

        {VARIABLE LoW_S2_phase 1}
    [/event]

    # start event
    [event]
        name=start

        {SIMPLE_MSG "Landar" ( _ "Hold there Kalenz. There should be a village here. There <i>is</i> a village here.")}

        {SIMPLE_MSG "Kalenz" ( _ "Then where are the villagers?")}

        {SIMPLE_MSG "Landar" ( _ "That’s exactly my question. It is much too quiet as well. Someone has scared off all of the birds here.")}

        {SIMPLE_MSG "Kalenz" ( _ "We have to investigate. But we should be on guard.")}

        {SIMPLE_MSG "Landar" ( _ "Stay close, venvä.")}

        {VARIABLE village_event 0}
    [/event]

    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=10,12
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=9,17
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=13,8
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=16,20
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=17,14
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=25,9
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: check village
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=24,15
        [/filter]
        [fire_event]
            name=village_events
            [primary_unit]
                id=$unit.id
            [/primary_unit]
        [/fire_event]
    [/event]
    # event: main village inspection event
    [event]
        name=village_events
        first_time_only=no
        [switch]
            variable=village_event
            [case]
                value=0
                [message]
                    speaker=unit
                    message= _ "Nobody here."
                [/message]
            [/case]
            [case]
                value=1
                [message]
                    speaker=unit
                    message= _ "It’s empty as well."
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    speaker=unit
                    message= _ "Nobody here."
                [/message]
            [/case]
            [case]
                value=4
                [message]
                    speaker=unit
                    message= _ "Nobody here."
                [/message]
            [/case]
            [case]
                value=5
                
                {SIMPLE_MSG unit ( _ "Hey, there's someone here!")}

                [unit]
                    side=1
                    id="Lothriel"
                    name=_"Lothiriel"
                    gender=female
                    type="Elvish Civilian"
                    hitpoints=2
                    x,y=$x1,$y1
                [/unit]

                {MOVE_UNIT (id="Kalenz") $x1 $y1}
                {MOVE_UNIT (id="Landar") $x1 $y1}

                {SIMPLE_MSG "Kalenz" ( _ "Hey, it's okay.")}

                {SIMPLE_MSG "Landar" ( _ "Quick, bring a shaman...")}

                # po: the dying elf villager warns Kalenz and Landar that she was left barely alive as a lure to trap more elves
                {SIMPLE_MSG "Lothiriel" ({WHISPER (_ "Run...Run...it's a trap!")})}

                {SIMPLE_MSG "Landar" ( _ "What are you...")}

                [kill]
                   id="Lothriel"
                   animate=yes
                [/kill]

                {VARIABLE_OP LoW_S2_village_ambush add 1}

                # fire the second phase
                [fire_event]
                    id=LoW_S2_village_ambush
                    name=LoW_S2_village_ambush
                [/fire_event]
            [/case]
        [/switch]

        {VARIABLE_OP village_event add 1}
    [/event]

    # event: village ambush
    [event]
        id=LoW_S2_village_ambush
        name=LoW_S2_village_ambush

        # set village ablaze

        # spawn ambushers

        # spawn embershard raid leader

        # some dialogue

        # show updated objectives
        [show_objectives]
        [/show_objectives]
    [/event]

    # event: defeating embershard raid leader

    # event: defeating all embershard orcs and goblins

    # death events
    {KALENZ_DEATH_EVENT}
    {LANDAR_DEATH_EVENT}
[/scenario]

#undef PLAYER_GOLD
